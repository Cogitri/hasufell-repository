# Copyright 2014 Julian Ospald <hasufell@posteo.de>
# Distributed under the terms of the GNU General Public License v2

MY_P=CUnit-${PV/_p/-}

require autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ 1.13 1.12 1.11 1.10 ] ]
# out of source build broken
require easy-multibuild [ multiunpack=true work=${MY_P} ]

SUMMARY="C Unit Test Framework"
DOWNLOADS="mirror://sourceforge/cunit/${MY_P}-src.tar.bz2"
HOMEPAGE="http://cunit.sourceforge.net"

SLOT="0"
LICENCES="LGPL-2"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="
    ncurses
    multibuild_c: ( 32 64 )
"

DEPENDENCIES="
    build+run:
        ncurses? ( sys-libs/ncurses[multibuild_c:*(-)?] )
"

DEFAULT_SRC_CONFIGURE_PARAMS=( --disable-static )
DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=(
    'ncurses curses'
)

prepare_one_multibuild() {
    # fix docdir messup
    edo sed -e "/^docdir/d" -i doc/Makefile.am
    edo sed -e '/^dochdrdir/{s:$(prefix)/doc/@PACKAGE@:$(docdir):}' -i doc/headers/Makefile.am

    edo sed -e "s/AM_CONFIG_HEADER/AC_CONFIG_HEADERS/" -i configure.in

    autotools_src_prepare
}


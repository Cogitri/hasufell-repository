# Copyright 2016 Julian Ospald <hasufell@posteo.de>
# Distributed under the terms of the GNU General Public License v2

require github [ user=utelle tag=v${PV} ]

SUMMARY="C++ wrapper around the public domain SQLite 3.x database"

LICENCES="wxWinLL-3"
SLOT="3.0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="
    ( providers: gtk2 gtk3 ) [[ number-selected = exactly-one ]]
"

DEPENDENCIES="
    build+run:
        dev-db/sqlite:3
        x11-libs/wxGTK:${SLOT}[providers:gtk3?][providers:gtk2?]
"

src_configure() {
    econf \
        --enable-shared \
        --enable-unicode \
        --with-wx-config="/usr/$(exhost --target)/lib/wx/config/$(option providers:gtk3 'gtk3' 'gtk2')-unicode-3.0" \
        --with-wxshared \
        --with-sqlite3-prefix="/usr/$(exhost --target)"
}

src_install() {
    default

    local gtkver
    if option providers:gtk3 ; then
        gtkver=3
    else
        gtkver=2
    fi

    # this is the upstream .pc file
    edo sed \
        -e "s:prefix=/usr:prefix=/usr/$(exhost --target):" \
        -e "s:wxcode_gtk2_wxsqlite3:wxcode_gtk${gtkver}u_wxsqlite3:" \
        -e "s:@WXVERSION@:${SLOT}:g" \
        -e "s:@LIBDIR@:lib:g" \
        -e "s:@VERSION@:${PV}:g" \
        ${PN}.pc.in > ${PN}.pc

    insinto /usr/$(exhost --target)/lib/pkgconfig
    doins ${PN}.pc
}

